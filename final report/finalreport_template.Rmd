---
title: "Final Report"
subtitle: "due November 16, 2021 by 11:59 PM "
author: "Kaitlyn Lewars and Katie Meehl: The Exposure Experience"
date: "November 16, 2021"
output: pdf_document
---
```{r loadp&d, warning=FALSE, message=FALSE}
library(tidyverse)
library(readr)
library(scales)
library(tidymodels)

Total_Air_Pollution_Death_Rate <- read_csv("~/R/Project Proposal/data/Total Air Pollution Death Rate.csv")
Household_Air_Pollution_Total_Deaths <- read_csv("~/R/Project Proposal/data/Household Air Pollution Total Deaths.csv")
Household_Air_Pollution_Rate <- read_csv("~/R/Project Proposal/data/Household Air Pollution Rate.csv")
Ambient_Air_Pollution_Rate <- read_csv("~/R/Project Proposal/data/WHO Ambient Air Pollution Rate.csv")
Ambient_Air_Pollution_Total_Deaths <- read_csv("~/R/Project Proposal/data/Ambient Air Pollution Total Deaths.csv")
Particulate_Ambient_Concentration <- read_csv("~/R/Project Proposal/data/Ambient Particulate Concentration.csv")
```

Climate change has been a recurring topic in the news in recent years as it becomes a more pressing problem. One of the important factors of climate change is air pollution. In 2017, air pollution was the 4th leading cause of mortality and the 5th leading cause of morbidity worldwide. As air pollution is a leading cause of morbidity and mortality, we thought it would be important to explore a data set investigating this problem. 

In general we would like to investigate air pollution as a cause of mortality globally. There are several different types of air pollution, but we will look at household pollution, ambient matter pollution, and ambient ozone pollution. With these variables we will compare them to see which air pollution is the most dangerous. We would also like to look into the trend of air pollution over the last 27 years. Lastly we would like to compare air pollution as a risk factor to other common risk factors. We downloaded this data from kaggle. There are several variables in this data including year, country, deaths by each type of air pollution, and deaths by other risk factors. 

The data collection is a bit complicated. In order to estimate deaths caused by pollution they use “mathematical functions, derived from epidemiological studies from countries around the world, that relate different levels of exposure to the increased risk of death or disability from each cause, by age and sex, where applicable, estimates of population exposure to PM2.5, ozone, and household air pollution, country-specific data on underlying rates of disease and death for each pollution-linked disease, and a comprehensive set of population data, adjusted to match the UN2015 Population Prospectus and obtained from the Gridded Population of the World (GPW) database for each country” (https://www.stateofglobalair.org/data/estimate-burden).

```{r ex1, warning=FALSE, message=FALSE}
Ambient_Air_Pollution_Rate %>%
  filter(Dim2 == "Total", Dim1 == "Both sexes") %>%
  ggplot(aes(x = FactValueNumeric)) +
  geom_histogram(binwidth = 10) +
  scale_x_continuous(labels = label_comma()) +
  labs(x = "Rate of Death (out of 100,000)",
       y = "Frequency",
       title = "Rates of Death due to Ambient Air Pollution in 2016")

Household_Air_Pollution_Rate %>%
  filter(Dim2 == "Total", Dim1 == "Both sexes") %>%
  ggplot(aes(x = FactValueNumeric)) +
  geom_histogram(binwidth = 10) +
  scale_x_continuous(labels = label_comma()) +
  labs(x = "Rate of Death (out of 100,000)",
       y = "Frequency",
       title = "Rates of Death due to Household Air Pollution in 2016")

Total_Air_Pollution_Death_Rate %>%
  filter(Dim2 == "Total", Dim1 == "Both sexes") %>%
  ggplot(aes(x = FactValueNumeric)) +
  geom_histogram(binwidth = 10) +
  scale_x_continuous(labels = label_comma()) +
  labs(x = "Rate of Death (out of 100,000)",
       y = "Frequency",
       title = "Rates of Death due to Air Pollution in 2016")
```

The four countries of interest are Democratic People's Republic of Korea, Georgia, Chad, and Bosnia and Herzegovina.


```{r ex2, warning=FALSE, message=FALSE}
joinedambient1 <- Ambient_Air_Pollution_Rate %>%
  rename(AmbientDeathRate = FactValueNumeric) %>%
  rename(Sex = Dim1) %>%
  rename(CauseofDeath = Dim2) %>%
  select(Location, Sex, CauseofDeath, AmbientDeathRate) %>%
  left_join(Ambient_Air_Pollution_Total_Deaths) %>%
  select(Location, Sex, CauseofDeath, AmbientDeathRate, FactValueNumeric) %>%
filter(CauseofDeath == "Total") %>%
  mutate(totalpopulation = (100000*FactValueNumeric)/AmbientDeathRate) %>%
  rename(Totaldeathsambient = FactValueNumeric)
```


```{r ex3, warning=FALSE, message=FALSE}
ambient <- Particulate_Ambient_Concentration %>%
  rename(AmbientAirConcentration = FactValueNumeric) %>%
  select(Location, AmbientAirConcentration) %>%
  left_join(joinedambient1, by = "Location") %>%
  select(Location, Sex, CauseofDeath, AmbientDeathRate, Totaldeathsambient, AmbientAirConcentration, totalpopulation) %>%
filter(CauseofDeath == "Total", Sex == "Both sexes")
```


```{r ex4, warning=FALSE, message=FALSE}
ambient %>%
  filter(!Location %in% c("China", "India")) %>%
  ggplot(aes(x = totalpopulation, y = Totaldeathsambient)) +
  geom_point(alpha = 0.25) +
  labs(title = "Death as a function of population size",
  x = "Population Size",
  y = "Death")
```

```{r ex7, warning=FALSE, message=FALSE}
death_ambientairpol <- linear_reg() %>%
  set_engine("lm") %>%
  fit(Totaldeathsambient ~ AmbientAirConcentration, data = ambient)
  print(death_ambientairpol)
```
deaths = -2601.0 + 274.1(AirConcentration)

```{r ex8, warning=FALSE, message=FALSE}
ggplot(data = ambient, aes(x = AmbientAirConcentration, y = Totaldeathsambient)) +
  geom_point(alpha = 0.25) +
  geom_smooth(method = "lm", se = FALSE, color = "orange") +
  labs(title = "Hair mercury as a function of age",
       subtitle = "Peruvian Amazon",
       x = "Age (years)",
       y = "Hair mercury (log ppm)")
```

```{r ex9, warning=FALSE, message=FALSE}
glance(death_ambientairpol)$r.squared
```

```{r}
ambient2 <- Particulate_Ambient_Concentration %>%
  rename(AmbientAirConcentration = FactValueNumeric) %>%
  select(Location, AmbientAirConcentration) %>%
  left_join(joinedambient1, by = "Location") %>%
  select(Location, Sex, CauseofDeath, AmbientDeathRate, Totaldeathsambient, AmbientAirConcentration, totalpopulation) %>%
filter(CauseofDeath == "Total", !Sex %in% c("Both sexes"))
```



```{r ex10, warning=FALSE, message=FALSE}
death_ambientairpol_totalpopulation <- linear_reg() %>%
    set_engine("lm") %>%
    fit(Totaldeathsambient ~ AmbientAirConcentration + totalpopulation , data = ambient)

print(death_ambientairpol_totalpopulation)

glance(death_ambientairpol_totalpopulation)$r.squared
```

